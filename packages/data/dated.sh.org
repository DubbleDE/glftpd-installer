#!/bin/bash
##########################
#                        #
# Created by Teqno       #
#                        #
##########################

today=`date +%m%d`                      # 1231
yesterday=`date --date "-1 day" +%m%d`  # 1230
lastyear=`date --date "-1 day" +%Y`     # 2013
year=`date +%Y`                         # 2014
gllog=/glftpd/ftp-data/logs/glftpd.log  # path to glftpd.log
glroot=/glftpd                          # path to glftpd
sections="
" 

if [ "$1" != "close" ]
then
    for section in $sections
    do
	for branchpath in site
	do
    	    chmod o-w $glroot/$branchpath/$section/*
            mkdir -m 755 -p $glroot/$branchpath/$section
	    mkdir -m 777 -p $glroot/$branchpath/$section/$today
    	    echo `date "+%a %b %e %T %Y"` TURDAY: \"$section/$today\" \"$yesterday\" \"$section\" >> $gllog
        done
	rm $glroot/site/!Today_$section
        cd /glftpd/site
	ln -s ./$section/$today !Today_$section
        cd ..
    done
else
    for section in $sections
    do
	for branchpath in site
        do
	    if [ "$yesterday" = "1231" ]
	    then
    		chmod 755 $glroot/$branchpath/$section/$yesterday
	        echo `date "+%a %b %e %T %Y"` TURDAYC: \"$section/$yesterday\" \"$today\" \"$section\" >> $gllog
    	    else
	        chmod 755 $glroot/$branchpath/$section/$yesterday
    		echo `date "+%a %b %e %T %Y"` TURDAYC: \"$section/$yesterday\" \"$today\" \"$section\" >> $gllog
            fi
	done
    done
fi
